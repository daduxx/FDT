<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://fiorenzofdt.com/wp-content/uploads/fiorenzo-digital-teamwear.jpg" >
    <title>FDT | Formattamento Taglie</title>

    <style>
        body {
            background-color: rgb(0, 0, 0);
            color: rgb(255, 255, 255);
            font-family:Verdana, Geneva, Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            height: 70vh;
            align-items: center;
            margin: 0;
        }

        #container {
            text-align: center;
        }

        input[type="text"], button {
            background-color: red;
            font-family:Verdana, Geneva, Tahoma, sans-serif;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        input[type="text"]::placeholder { 
            color: white;
        }

        input[type="text"] {
            width: 250px;
            margin-right: 10px;
            ;
        }

        button:hover {
            background-color: #990000;
        }

    </style>

</head>
<body>
    <div id="container">
        <img src="https://fiorenzofdt.com/wp-content/themes/sublimatico1.4/images/fiorenzo-digital-teamwear.gif">
        <br><br><br>
        <input type="text" id="numCol" placeholder="Inserisci colonna"> 
        <input type="text" id="sep" placeholder="Inserisci separatore (, / ;)">  <br><br>
        <button onclick="processCSV()">Ordina CSV</button>
        <button onclick='window.location.href = "./info.html"'>Info </button>
    </div>

    <script>
        // Funzione per ottenere l'indice dell'ordine delle taglie
        function getSizeOrderIndex(size) {
            const sizeOrder = ['128', '140', '152', '6Y', '6 ANNI', '8Y', '8 ANNI', '10Y', '10 ANNI', '12Y', '12 ANNI', 'XS', 'S', 'M', 'L', 'XL', 'XXL', '2XL', 'XXL (2XL)', 'XXXL', '3XL', 'XXXL (3XL)', 'XXXXL', '4XL', 'XXXXL (4XL)'];
            return sizeOrder.indexOf(size);
        }


        // Funzione per ordinare gli oggetti in base alla colonna specificata
        function sortByColumn(csvData, columnIndex) {
            const rows = csvData.split('\n');

            // Rimuovi l'ultima riga se è vuota
            if (rows[rows.length - 1] === '') {
                rows.pop();
            }

            // Rimuovi l'header
            const header = rows.shift();

            //trova il separatore
            let sep = document.getElementById('sep').value;
            if(sep == ""){
                console.log("SEPARATORE STANDARD");
            }
            
            // Ordina gli oggetti in base alla colonna specificata
            rows.sort((a, b) => {
                const columnsA = a.split(sep);
                const columnsB = b.split(sep);

                const sizeA = columnsA[columnIndex - 1] ? columnsA[columnIndex - 1].trim() : '';
                const sizeB = columnsB[columnIndex - 1] ? columnsB[columnIndex - 1].trim() : '';

                const sizeOrderIndexA = getSizeOrderIndex(sizeA);
                const sizeOrderIndexB = getSizeOrderIndex(sizeB);

                return sizeOrderIndexA - sizeOrderIndexB;
            });

            // Ricostruisci il file CSV ordinato
            const sortedCsv = [header, ...rows].join('\n');

            return sortedCsv;
        }

        function processCSV() {
            // Leggi il file CSV
            const inputElement = document.createElement('input');
            inputElement.type = 'file';
            inputElement.accept = '.csv';
            inputElement.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvData = e.target.result;

                    // Specifica il numero di colonna da ordinare
                    let numColInput = document.getElementById('numCol');
                    const columnIndex = parseInt(numColInput.value);

                    // Ordina gli oggetti per la colonna specificata
                    const sortedCsv = sortByColumn(csvData, columnIndex);

                    // Crea un oggetto Blob con i dati ordinati
                    const blob = new Blob([sortedCsv], { type: 'text/csv' });

                    // Crea un URL temporaneo per il download del file
                    const url = URL.createObjectURL(blob);

                    // Crea un link per il download e simula il clic
                    const downloadLink = document.createElement('a');
                    downloadLink.href = url;
                    downloadLink.download = 'output.csv';
                    downloadLink.style.display = 'none';
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);

                    // Rilascia l'URL temporaneo
                    URL.revokeObjectURL(url);

                    console.log('File CSV ordinato è stato creato con successo.');
                };
                reader.onerror = function() {
                    console.error('Errore nella lettura del file.');
                };
                reader.readAsText(file);
            };
            inputElement.click();
        }
    </script>
</body>
</html>
